DC = docker compose
NETWORK_NAME = microservices-network
GRAFANA_NETWORK_NAME = grafana-network

# üëâ –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ (–Ω–µ –ø–∞–¥–∞—Ç—å, –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –µ—Å—Ç—å)
network:
	-@docker network rm $(NETWORK_NAME)
	@docker network create $(NETWORK_NAME)
	-@docker network rm $(GRAFANA_NETWORK_NAME)
	@docker network create $(GRAFANA_NETWORK_NAME)

grafana:
	cd monitoring && $(DC) -f docker-compose-override.yaml up --build -d

down-grafana:
	cd monitoring && $(DC) -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å kafka (–±—Ä–æ–∫–µ—Ä)
broker:
	cd kafka && $(DC) -f docker-compose-override.yaml up --build -d

down-broker:
	cd kafka && $(DC) -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å user —Å–µ—Ä–≤–∏—Å
user:
	cd user-service && $(DC) --env-file .env -f docker-compose-override.yaml up --build -d

down-user:
	cd user-service && $(DC) --env-file .env -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å text —Å–µ—Ä–≤–∏—Å
text:
	cd text-service && $(DC) --env-file .env -f docker-compose-override.yaml up --build -d

down-text:
	cd text-service && $(DC) --env-file .env -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å image —Å–µ—Ä–≤–∏—Å
image:
	cd image-service && $(DC) --env-file .env -f docker-compose-override.yaml up --build -d

down-image:
	cd image-service && $(DC) --env-file .env -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å telegram —Å–µ—Ä–≤–∏—Å
telegram:
	cd telegram-service && $(DC) --env-file .env -f docker-compose-override.yaml up --build -d

down-telegram:
	cd telegram-service && $(DC) --env-file .env -f docker-compose-override.yaml down

# üëâ –ü–æ–¥–Ω—è—Ç—å –≤—Å—ë (–ø–æ –ø–æ—Ä—è–¥–∫—É)
production: network grafana broker image user telegram

all: network broker image user telegram

down-all: down-user down-broker down-image down-telegram
	@docker network rm $(NETWORK_NAME) || true

# üëâ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
down-production: down-image down-grafana down-user down-broker down-text down-telegram
	@docker network rm $(NETWORK_NAME) || true
	@docker network rm $(GRAFANA_NETWORK_NAME) || true