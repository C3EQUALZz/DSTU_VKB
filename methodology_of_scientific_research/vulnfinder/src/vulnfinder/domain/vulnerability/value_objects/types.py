from dataclasses import dataclass

from vulnfinder.domain.common.errors import DomainFieldError
from vulnfinder.domain.common.values.base import BaseValueObject


@dataclass(frozen=True, eq=True)
class VulnerabilityType(BaseValueObject):
    value: str

    def _validate(self) -> None:
        if not self.value.strip():
            msg = "VulnerabilityType cannot be blank."
            raise DomainFieldError(msg)

    def __str__(self) -> str:
        return self.value


@dataclass(frozen=True, eq=True)
class Severity(BaseValueObject):
    value: str

    def _validate(self) -> None:
        allowed = {"LOW", "MEDIUM", "HIGH", "CRITICAL"}
        if self.value not in allowed:
            msg = f"Invalid severity: {self.value!r}"
            raise DomainFieldError(msg)

    def __str__(self) -> str:
        return self.value


@dataclass(frozen=True, eq=True)
class Confidence(BaseValueObject):
    value: float

    def _validate(self) -> None:
        if not 0.0 <= self.value <= 1.0:
            msg = "Confidence must be between 0 and 1."
            raise DomainFieldError(msg)

    def __str__(self) -> str:
        return f"{self.value:.2f}"


@dataclass(frozen=True, eq=True)
class Recommendation(BaseValueObject):
    value: str

    def _validate(self) -> None:
        if not self.value.strip():
            msg = "Recommendation cannot be blank."
            raise DomainFieldError(msg)

    def __str__(self) -> str:
        return self.value
