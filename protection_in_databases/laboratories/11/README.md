# 11 лабораторная работа

> [!IMPORTANT]
> Лабораторную, к сожалению, невозможно выполнить с помощью `Docker` из-за особенностей `SeLinux` под `Docker`.
> Мною было проведено исследование по попытке настроить `SeLinux` в `Docker контейнерах`.
> Были попытки создания кастомных образов и их настройки, но все было тщетно. 
> Сурс, по которому я тоже убедился, что нельзя сделать с помощью `Docker` [тык](https://serverfault.com/questions/757606/how-to-enable-selinux-inside-of-a-centos-docker-container)

Мною было решено установить `Fedora Linux` для выполнения данной лабораторной работы. 
В дальнейшем гайд будет расписан только для `Fedora Linux`. 

> [!NOTE]
> Для скачки `iso` и создания носителя ссылка [тык](https://fedoraproject.org/workstation/download)

> [!NOTE]
> Сожалею пользователям `Nvidia`, здесь у вас начинаются знатные приколы с установкой. 

> [!NOTE]
> На момент 09.08.2025 не получается поставить обновления, какие-то массовые проблемы у Яндекс зеркал.

#### Настройка `SELinux`

Если вы установили `Fedora`, то у вас по умолчанию уже включен `SELinux`. 
`Red Hat` по умолчанию включают и настраивают прямо из коробки. 

Если хотите убедиться, то используйте команду в терминале, которая представлена ниже: 

```bash
getenforce
```

> [!NOTE]
> В вашем случае должен быть режим `Enforcing`. 

#### Установка `PostgreSQL`. 

Для установки я использовал мануал, ничего сверхъестественного. Также советую от себя поставить `Dbeaver`. 

> [!NOTE]
> Манул по установке от `Fedora` [тык](https://docs.fedoraproject.org/en-US/quick-docs/postgresql/)

> [!NOTE]
> Через `Docker` не получится здесь все телодвижения для лабы, поэтому нужно ставить нативно. 

#### Настройка `postgresql.conf`

Теперь нам нужно в нативе настроить `postgresql.conf`, добавив `sepgsql`.

Для этого откройте файл `/var/lib/pgsql/data/postgresql.conf` через удобный вам текстовый редактор.
В моем случае я буду использовать `gedit`. 

Для открытия использую команду, которая представлена ниже: 

```bash
sudo gedit /var/lib/pgsql/data/postgresql.conf
```

В конце добавьте просто строку `shared_preload_libraries = 'sepgsql'`

Теперь нам нужно перезапустить `PostgreSQL`:

```bash
sudo systemctl restart postgresql
```

Поздравляю. У вас создан `PostgreSQL` с `SeLinux`. 

> [!IMPORTANT]
> В методичке абсолютно неправильно расписано про синтаксис взаимодействия с `SELinux`. 
> Официальная документация с примерами [тык](https://www.postgresql.org/docs/current/sepgsql.html)

> [!IMPORTANT]
> Здесь нашел отрывок, что в `sql` коде не нужно использовать `CREATE EXTENSION`, [тык](https://pigsty.io/ext/sec/sepgsql/)