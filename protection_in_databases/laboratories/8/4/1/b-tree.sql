CREATE EXTENSION IF NOT EXISTS pg_trgm;
DROP TABLE IF EXISTS products CASCADE;
DROP TABLE IF EXISTS sales CASCADE;
DROP INDEX IF EXISTS idx_sales_product;


CREATE TABLE products
(
    product_id   SERIAL PRIMARY KEY,
    product_name VARCHAR(100) UNIQUE              NOT NULL,
    price        DECIMAL(10, 2) CHECK (price > 0) NOT NULL
);

CREATE TABLE sales
(
    sale_id    SERIAL PRIMARY KEY,
    product_id INT NOT NULL REFERENCES products (product_id) ON DELETE CASCADE,
    quantity   INT NOT NULL
);

CREATE INDEX idx_sales_product ON sales USING BTREE (product_id);


-- Тестовые данные (объединённые в одну команду INSERT)
INSERT INTO products (product_name, price)
VALUES ('cqwG', 630.78),
       ('IxIHJzCiVPyEAJOKTUEUOO', 944.54),
       ('K uLnlefGVw', 717.01),
       ('ufJONxFEkMlN', 578.45),
       ('TDutT', 591.77),
       ('SufMnHbkzuXCZryu jU', 930.11),
       ('bTl', 380.72),
       ('CfibBZdwUAWlNcIqnE y', 606.92),
       ('UaCmiKgvv', 720.27),
       ('JLjYMviYvX', 940.38),
       ('GYvgausJL', 379.59),
       ('tRio TI', 540.32),
       ('MTxjTdTsfXQIrweVUlZPNh', 916.38),
       ('EkvDJzsHeUyvwHooirOvrAG', 326.11),
       ('ZmAkpsefyTGAIQpGlIGJjQqhZ', 580.42),
       ('HUrKfheBPCqErWethOXOkEeQJ', 144.27),
       ('UKntXxSBtuszsdMMZTuk', 55.49),
       ('jVNeE rAzMerqyQqw', 462.57),
       ('JVIuPOnnHKFKoKXyHvM ', 315.45),
       ('vjnCaizFAzlMxsnQBNtQD', 713.51),
       ('gaTTel', 14.88),
       ('AQOZPujDwXsgoekm MhvZulg', 467.06),
       ('xNlv enHaTkuRNHqgZSRQ', 798.08),
       ('HHL sxRbHPznJmZIhXOMlX', 925.79),
       ('DzngBOlHYHiWzNy', 537.66),
       ('QyySCDTJSOTUXZGUk', 125.64),
       ('JHMEPoWphDLhAtmHSZZVi', 379.84),
       ('wRwgzTkYmvGEFtVCgpzQ', 40.87),
       ('xOwFSkRFTuDPQHdOHaiZzjPV', 139.08),
       ('SeCab', 802.3),
       ('wRT', 79.31),
       ('qqLwSuLNbWGeDM', 871),
       ('oNpZMEkR', 252.61),
       ('MPHtqGtUHEclkswLcKh', 274.2),
       ('IuLTkJxPFJqLZ', 413.89),
       ('HVAwPyM', 491.53),
       ('rgRCnlkVgXmGVwPHgBkAxEv', 236.86),
       ('pOwR gnt', 344.66),
       ('Df', 989.12),
       ('TmuoiHHWWtMFav', 944.76),
       ('IFwrYDGvbyTDgS', 222.92),
       ('zft WFVcNjpBN', 660.16),
       ('GpcBYVpwfGKHqpuraBl', 3.46),
       ('audnRSPSQAokWbFViWxCjeRH', 500.55),
       ('EHDDUxmXVrrptSeSrOamE', 825.65),
       ('UTChZdWr TNocShtc', 182.39),
       ('HTBrTWajrqyt oNKQIvTMgr', 849.95),
       ('KlsR', 573.65),
       ('NFjB MIGwe', 486.72),
       ('LNjREOwEu', 701.34),
       ('IxSgSJqyTYj', 958.85),
       ('GVyxwFOhFY', 845.63),
       ('dcpDVtsXWtGJHqDaQQnCbk', 46.02),
       ('qx qxPRJWsFnqnIjJP', 724.33),
       ('NCT', 483.69),
       ('MFFJkxvJNVwzRt', 442.2),
       ('oTGRwE', 776.93),
       ('KCqFqlOL', 865.78),
       ('hhtrgBNLesHJR', 855.62),
       ('aFZEvAlGyPeRipCFn', 561.06),
       ('NYkLUjpRQiBPjbYGYcoyEED', 804.75),
       ('lhmzp', 37.68),
       ('HfIcgFkk', 623.79),
       ('tpUSWGf Eczps', 242.25),
       ('EQcOd', 732.88),
       (' yxrygrMLPJvJzIVM', 905.86),
       ('ewReQYBTqu', 264.26),
       ('UikXMFzXhcvHZXqFUOfPJtx', 885.54),
       ('aRwFaoNZkkezEHVugDZcymbdh', 932.79),
       ('L SDZvmbaSIovU', 709.55),
       ('IpzN chbMEQnTWDdSZFO', 98.09),
       ('vjDbngqNxQk', 554.35),
       ('hMBVoiNqukSvoJYAlv', 415.4),
       ('JIoKItbLoTeVbqoGcZGYcb X', 423.24),
       ('vN', 436.7),
       ('cnrTS', 397.94),
       ('SwdWnaAQcDxcLc', 533.16),
       ('eEIhefsCsgbMv', 387.85),
       ('qaVYVEAEYMxBuUmYRz', 940.69),
       ('rEBFZ', 934.86),
       ('KJIlhbipGovQybQWDXMpWG', 398.65),
       ('xrpxzmGAP', 483.54),
       ('njQcRCmLDMWlVgiJb', 553.87),
       ('WR', 879.33),
       ('RRYlTB', 595.87),
       ('WGQfsAllQdnjagcSBqUBIzEjK', 190.01),
       ('SKXWJaFLeYKV', 778.51),
       ('PqKJIG', 804.12),
       ('PhspXR', 575.1),
       ('RMNMLZDv', 568.62),
       ('VmbhwbiFoULtbFQGVfEbDjI', 566.86),
       ('DaQAUF', 230.67),
       ('UrbvdpQmHWsLaYTx', 636.26),
       ('MpnbRyIczbEdgoNYAAlUY', 88.98),
       ('vdzKdgFcAvEptCsyPQ', 658.33),
       ('YGbcqfwNIqeooqEeKXnVh', 943.28),
       ('RJuiJXzheYpb', 120.38),
       ('SNoPFWpPkvTVaYRliBC', 46.3),
       ('VNwHkkswQtbHty', 270.03),
       ('r ', 45.58),
       ('JpAlrpGRbjsWL', 952.18),
       ('fjSUnzaOEr', 163.33),
       ('XkkBuxJkeUBIGI', 41.15),
       ('NDOYxsN GpIHLIoTbpVo', 594.58),
       ('YgiqLaeYQgCEI', 85.11),
       ('AvDnfeO', 281.14),
       ('rxclJEnCZrSjzVaPGC', 581.28),
       ('YbQFUQUDCeOKHBYqxYZEPInm', 770.72),
       ('zhJjL tUPEBhyy', 947.56),
       ('tytG aYSdeErqbRhC', 434.31),
       ('IDqzXhFbBJi DcChe', 233.45),
       ('AkxPSPAHeuLKgMSikkKBVDuCF', 435.62),
       ('kUmwfoUNGQOXogSlh', 776.56),
       ('FWimuqxLWYOZLroRpHMR', 835.24),
       ('ASCHUDziSgwstZBCZk', 911),
       ('mkJYHmokdQ s', 634.76),
       ('cJFbrXk D VQyEfcSNvZxL', 840.52),
       ('sts', 7),
       ('baEhN', 997.2),
       ('GT', 576.03),
       ('vvEtfdnDdra', 482.38),
       ('ZLBYPNex zlqOLKsWlGbJfL', 642.57),
       ('zRSNbZkrrbXwKpWqCN', 202.2),
       ('fKxhHfLxnEUliUlXgyUKIJM', 675.37),
       ('ptvKojovOIrG', 76.93),
       ('SlEluJsHmhVvJaY', 515.07),
       ('brQKVC hTVQHHloESNV', 679.79),
       ('KAZqZNOXTSbPDEP ', 367.47),
       ('BQnKcQXCn', 323.93),
       ('HK', 91.39),
       ('hS lmMEDIkwQVCptDHvgV', 478.2),
       ('IsVpuOyXULCpyBmr', 446.7),
       ('TAPUYLo', 800.43),
       ('bMTCfvkPUFedWxwxMejgbx', 676.53),
       ('WzzKjurNPiGQd VUiq', 679.36),
       ('GzANsHtzclpvFMPwaQwo', 478.71),
       ('BvJIIHNIdjLHrIf', 86.12),
       ('NKakJTFjHUYXqJuSsiBu', 995.08),
       ('avJUcpoLlnjYmYgGC', 942.96),
       (' EaYdEQOxlxa', 46.33),
       ('izrzwg rmcdxgzizu mGt', 885.12),
       ('ovfP iZNnQyVdeqKicMlo', 832.7),
       ('bsyyVNcsehSleYjchZKKfSjX', 761.99),
       ('jvsBpYoJbRr', 972.89),
       (' giLdEualQLhxlRXvsqnZ', 952.95),
       ('mvFdbsrFhfhPhvixfewsyXQs', 710.62),
       ('HNyZtbClKuJxEIW ', 873.55),
       ('CxekCDlmuXtShZtZy', 753.65),
       ('OShXYMahJWpAA', 685.11),
       ('IeKnuW QIb', 17.24),
       ('qdrLgvTXrEN', 988.8),
       ('XBLHtCAqKPpfze y ', 204.35),
       ('JUe', 111.31),
       ('hokwWKneTaimFWpoLOru St', 492.35),
       ('XtSXHKxnLnKPaP', 412.03),
       ('QzcZkvGguInv JeTgDtvjMiGP', 43.02),
       ('wKMANaZwoVqaemvuxTdsAexx', 75.49),
       ('zqYyoEz Er HswCImefzANZx', 296.8),
       ('TLVgfPUlD', 885.65),
       ('lSIwMXjFIrCL', 139.59),
       ('yUYE', 594.29),
       ('XOB', 6000),
       ('Смартфон', 25000.00);

INSERT INTO sales (product_id, quantity)
VALUES (108, 192586),
       (133, 532223),
       (115, 816967),
       (5, 630606),
       (32, 264639),
       (5, 235968),
       (1, 499399),
       (26, 972210),
       (61, 258901),
       (157, 381730),
       (73, 439024),
       (77, 236085),
       (66, 81951),
       (72, 237840),
       (52, 960079),
       (102, 271166),
       (81, 543031),
       (104, 399399),
       (81, 297862),
       (51, 361733),
       (40, 969191),
       (98, 21561),
       (140, 969751),
       (1, 823887),
       (52, 219085),
       (56, 555471),
       (34, 260790),
       (135, 644414),
       (27, 124598),
       (139, 571990),
       (116, 504942),
       (3, 777741),
       (93, 253610),
       (95, 852549),
       (66, 696586),
       (80, 800301),
       (115, 74573),
       (75, 439017),
       (59, 596035),
       (42, 411540),
       (109, 720389),
       (20, 400834),
       (158, 441818),
       (154, 462425),
       (113, 747035),
       (110, 63552),
       (146, 495819),
       (150, 967192),
       (68, 318717),
       (118, 689838),
       (157, 792741),
       (84, 799189),
       (25, 981318),
       (106, 272098),
       (133, 571530),
       (61, 239407),
       (131, 959336),
       (103, 851010),
       (52, 235988),
       (109, 756910),
       (12, 768690),
       (149, 511148),
       (16, 526437),
       (13, 139516),
       (104, 375688),
       (12, 56315),
       (89, 608622),
       (28, 859496),
       (160, 339457),
       (127, 504951),
       (91, 306183),
       (137, 523008),
       (29, 665805),
       (101, 513322),
       (145, 508176),
       (61, 264101),
       (47, 107637),
       (126, 818752),
       (36, 474002),
       (85, 599936),
       (61, 268597),
       (107, 557518),
       (112, 850718),
       (94, 653956),
       (7, 151074),
       (36, 704169),
       (24, 477156),
       (134, 717276),
       (23, 564159),
       (91, 63543),
       (2, 3619),
       (138, 47795),
       (156, 771017),
       (11, 439470),
       (47, 940089),
       (106, 28739),
       (81, 51025),
       (26, 225332),
       (125, 285162),
       (61, 982907),
       (158, 323248),
       (75, 469186),
       (136, 212340),
       (47, 564079),
       (2, 121249),
       (128, 436818),
       (83, 16416),
       (141, 364222),
       (32, 70529),
       (126, 531623),
       (46, 240628),
       (157, 49156),
       (116, 944260),
       (43, 637369),
       (67, 511382),
       (45, 702266),
       (81, 938576),
       (81, 361404),
       (55, 638940),
       (58, 462540),
       (25, 182983),
       (123, 355293),
       (47, 198085),
       (30, 830559),
       (40, 565754),
       (58, 530244),
       (102, 499519),
       (70, 178322),
       (81, 285955),
       (154, 964708),
       (10, 126558),
       (131, 10734),
       (123, 299088),
       (6, 655041),
       (10, 672805),
       (157, 633325),
       (80, 351023),
       (1, 897715),
       (23, 468698),
       (41, 719720),
       (38, 694688),
       (21, 836517),
       (137, 393527),
       (32, 612108),
       (135, 968979),
       (146, 338586),
       (128, 847792),
       (75, 32257),
       (28, 832533),
       (54, 561032),
       (48, 110182),
       (109, 738269),
       (156, 661775),
       (153, 32590),
       (22, 899178),
       (71, 258649),
       (88, 519203),
       (140, 512908),
       (161, 529066),
       (93, 149034),
       (72, 190474),
       (56, 964021),
       (34, 23939),
       (136, 146169),
       (68, 292376),
       (10, 60764),
       (116, 842652),
       (100, 904720),
       (7, 493722),
       (75, 556502),
       (135, 215306),
       (150, 138095),
       (49, 675739),
       (23, 519624),
       (48, 398626),
       (108, 374797),
       (85, 559810),
       (113, 148616),
       (87, 738352),
       (74, 977400),
       (2, 359722),
       (120, 268734),
       (100, 490918),
       (47, 237342),
       (72, 106522),
       (125, 398793),
       (47, 308154),
       (70, 48227),
       (18, 218791),
       (116, 853027),
       (26, 927486),
       (30, 111118),
       (2, 291834),
       (126, 512217),
       (27, 999673),
       (48, 590315),
       (153, 145966),
       (97, 351637),
       (74, 978551),
       (58, 513904),
       (137, 302334),
       (63, 483092),
       (26, 379681),
       (46, 205280),
       (8, 614085),
       (20, 270202),
       (75, 937562),
       (5, 753395),
       (149, 527596),
       (133, 879280),
       (19, 884891),
       (53, 575412),
       (71, 858567),
       (69, 718211),
       (30, 860086),
       (24, 897242),
       (130, 350756),
       (32, 262532),
       (29, 491923),
       (136, 318628),
       (16, 994831),
       (72, 48488),
       (104, 953133),
       (131, 157265),
       (120, 120712),
       (87, 333873),
       (100, 606552),
       (100, 415108),
       (58, 410878),
       (80, 612262),
       (11, 358121),
       (144, 809519),
       (69, 917824),
       (15, 722717),
       (29, 388518),
       (79, 480902),
       (25, 708146),
       (111, 57356),
       (88, 837326),
       (10, 919043),
       (9, 859752),
       (114, 198276),
       (22, 17117),
       (143, 756205),
       (145, 351348),
       (74, 352542),
       (75, 485662),
       (95, 611350),
       (77, 592809),
       (54, 233585),
       (3, 487612),
       (144, 172703),
       (26, 186463),
       (16, 126982),
       (15, 730382),
       (18, 580519),
       (51, 67652),
       (100, 102888),
       (38, 645643),
       (127, 931138),
       (34, 219007),
       (139, 456645),
       (121, 45725),
       (126, 322530),
       (146, 63810),
       (108, 947296),
       (126, 770435),
       (95, 624097),
       (156, 682086),
       (158, 570647),
       (156, 454294),
       (102, 206864),
       (36, 227837),
       (11, 194656),
       (89, 725382),
       (130, 753466),
       (124, 369126),
       (124, 82764),
       (50, 81479),
       (48, 66713),
       (132, 480697),
       (96, 139255),
       (64, 762680),
       (130, 711616),
       (83, 262987),
       (26, 954104),
       (106, 623487),
       (152, 847682),
       (67, 842422),
       (67, 864265),
       (139, 165096),
       (68, 621294),
       (160, 132754),
       (115, 894324),
       (15, 626489),
       (159, 916893),
       (34, 274349),
       (59, 708299),
       (87, 331635),
       (26, 721538),
       (118, 507743),
       (48, 849800),
       (56, 470126),
       (52, 75383),
       (106, 542774),
       (77, 585424),
       (42, 333487),
       (103, 801196),
       (110, 233526),
       (109, 938985),
       (110, 519178),
       (70, 486580),
       (13, 241090),
       (117, 67196),
       (91, 91644),
       (64, 793511),
       (34, 526758),
       (148, 530357),
       (29, 357957),
       (97, 801525),
       (112, 377773),
       (84, 144431),
       (42, 640857),
       (63, 259761),
       (101, 67328),
       (15, 495325),
       (53, 118329),
       (54, 544701),
       (58, 101958),
       (22, 714219),
       (85, 317037),
       (157, 562050),
       (84, 517763),
       (95, 70665),
       (119, 679328),
       (111, 337505),
       (149, 987530),
       (72, 883653),
       (65, 198704),
       (86, 923569),
       (97, 884557),
       (108, 889206),
       (59, 697094),
       (123, 592093),
       (19, 484381),
       (122, 109747),
       (109, 915923),
       (100, 693143),
       (82, 122867),
       (73, 170474),
       (19, 7178),
       (47, 68883),
       (161, 935868),
       (46, 460898),
       (79, 792149),
       (17, 470761),
       (17, 422040),
       (157, 490495),
       (49, 481719),
       (64, 571895),
       (31, 650469),
       (38, 887266),
       (10, 514965),
       (140, 683804),
       (35, 802365),
       (98, 997344),
       (107, 884660),
       (99, 144179),
       (143, 989318),
       (46, 276066),
       (19, 33557),
       (98, 864464),
       (75, 601031),
       (88, 195245),
       (94, 64644),
       (35, 279861),
       (59, 897438),
       (67, 299641),
       (83, 260809),
       (98, 668271),
       (45, 214141),
       (74, 289182),
       (34, 732612),
       (32, 602449),
       (60, 24241),
       (50, 707903),
       (153, 775460),
       (102, 563400),
       (148, 582417),
       (48, 520087),
       (1, 598409),
       (33, 909636),
       (8, 129443),
       (48, 716843),
       (150, 779718),
       (160, 315461),
       (73, 410770),
       (97, 810087),
       (19, 189109),
       (13, 443192),
       (111, 838554),
       (99, 211300),
       (125, 48046),
       (54, 474655),
       (154, 942278),
       (39, 540286),
       (138, 18822),
       (127, 419333),
       (36, 261761),
       (51, 108695),
       (103, 452619),
       (160, 232182),
       (28, 293984),
       (104, 905946),
       (13, 335765),
       (45, 120917),
       (62, 158262),
       (79, 182314),
       (135, 316234),
       (47, 142904),
       (96, 967686),
       (125, 895981),
       (47, 226400),
       (58, 876712),
       (75, 329447),
       (150, 688651),
       (23, 529851),
       (19, 883240),
       (139, 883746),
       (11, 413056),
       (61, 201080),
       (24, 156667),
       (158, 407449),
       (1, 808948),
       (45, 690633),
       (17, 818814),
       (103, 782137),
       (65, 937715),
       (79, 55225),
       (160, 580446),
       (27, 26645),
       (141, 867296),
       (96, 459788),
       (89, 853751),
       (91, 526043),
       (103, 730234),
       (159, 960544),
       (101, 427395),
       (82, 355288),
       (18, 287174),
       (111, 608888),
       (109, 684749),
       (23, 599753),
       (68, 250589),
       (124, 732276),
       (28, 422069),
       (158, 166746),
       (107, 439836),
       (9, 710661),
       (17, 475651),
       (43, 244121),
       (1, 400443),
       (53, 821329),
       (84, 423247),
       (87, 621299),
       (67, 896646),
       (62, 336034),
       (7, 643678),
       (76, 155980),
       (114, 107219),
       (134, 136273),
       (95, 253106),
       (3, 160361),
       (31, 901675),
       (121, 965157),
       (25, 650493),
       (43, 981566),
       (2, 972872),
       (49, 785614),
       (37, 824382),
       (141, 849558),
       (156, 828765),
       (2, 900256),
       (63, 801558),
       (57, 752232),
       (23, 62526),
       (115, 320017),
       (76, 762251),
       (53, 431419),
       (36, 65848),
       (53, 531731),
       (4, 303949),
       (69, 46890),
       (8, 820661),
       (121, 936300),
       (141, 738995),
       (18, 938606),
       (30, 987077),
       (155, 942112),
       (119, 390092);